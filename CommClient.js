"use strict";var CommClient=function(){function a(){this.actions=["getRoster","getVCard","enableCarbons","sendPresence","searchHistory","joinRoom","addBookmark","getRoomMembers","configureRoom","setRoomAffiliation","directInvite","destroyRoom","removeBookmark","getDiscoItems","getBookmarks","setBookmarks","leaveRoom"],this.connectedOnce=!1,this.generatedId=this.makeid(),this.connected=!1,this.disconnectedByUser=!1}return a.prototype.createClient=function(a){var b=this;return a.transport="websocket",a.resource="marandChat"+(1e3*Math.random()+1).toString().replace(".",""),a.wsURL="wss://comm.marand.si/websocket/",a.useStreamManagement=!0,this.socket=io.connect("wss://comm.marand.si",{query:"idGen="+this.generatedId}),this.socket.on("disconnect",function(){if(b.connected=!1,b.connectedOnce=!1,!b.disconnectedByUser)var c=setInterval(function(){b.connected?clearTimeout(c):(b.socket.connect(),b.socket.emit("init",a))},3e3);console.log("Disconnected....")}),this.socket.on("connect",function(){console.log("Connected...."),b.connected=!0,b.connectedOnce||(b.socket.emit("init",a),b.connectedOnce=!0)}),this},a.prototype.connect=function(){this.socket.connect(),this.socket.emit("connect")},a.prototype.queryContent=function(a){this.socket.emit("queryMetadata",a)},a.prototype.disconnect=function(a){a&&(this.disconnectedByUser=!0),this.connectedOnce=!1,this.socket.disconnect()},a.prototype.on=function(a,b){var c=this;this.socket.on(a,function(d,e){"session:started"==a&&(c.jid=e.jid),b(d,e)})},a.prototype.getRoster=function(a){var b=this;this.socket.emit("getRoster"),this.socket.on("getRoster",function(c,d){b.socket.removeListener("getRoster"),a(c,d)})},a.prototype.getVCard=function(a,b){var c=this;this.socket.emit("getVCard",a),this.socket.on("getVCard"+a,function(d,e){c.socket.removeListener("getVCard"+a),b(d,e)})},a.prototype.enableCarbons=function(){this.socket.emit("enableCarbons")},a.prototype.sendPresence=function(){this.socket.emit("sendPresence")},a.prototype.searchHistory=function(a,b){var c=this,d=this.makeid();a.reqId=d,this.socket.emit("searchHistory",a),this.socket.on("searchHistory"+d,function(a,e){c.socket.removeListener("searchHistory"+d),b(a,e)})},a.prototype.joinRoom=function(a,b,c,d){var e=this;this.socket.emit("joinRoom",a,b,c),this.socket.on("joinRoom"+a,function(b,c){e.socket.removeListener("joinRoom"+a),d&&d(b,c)})},a.prototype.addBookmark=function(a){this.socket.emit("addBookmark",a)},a.prototype.getRoomMembers=function(a,b,c){var d=this;this.socket.emit("getRoomMembers",a,b),this.socket.on("getRoomMembers"+a,function(b,e){d.socket.removeListener("getRoomMembers"+a),c&&c(b,e)})},a.prototype.sendMessage=function(a){this.socket.emit("sendMessage",a)},a.prototype.configureRoom=function(a,b,c){var d=this;this.socket.emit("configureRoom",a,b),this.socket.on("configureRoom"+a,function(b,e){d.socket.removeListener("configureRoom"+a),c&&c(b,e)})},a.prototype.setRoomAffiliation=function(a,b,c,d,e){var f=this;this.socket.emit("setRoomAffiliation"+a,a,b),this.socket.on("setRoomAffiliation"+a,function(b,c){f.socket.removeListener("setRoomAffiliation"+a),e&&e(b,c)})},a.prototype.directInvite=function(a,b){this.socket.emit("directInvite",a,b)},a.prototype.destroyRoom=function(a,b,c){var d=this;this.socket.emit("destroyRoom",a,b),this.socket.on("destroyRoom"+a,function(b,e){d.socket.removeListener("destroyRoom"+a),c&&c(b,e)})},a.prototype.removeBookmark=function(){this.socket.emit("removeBookmark")},a.prototype.getDiscoItems=function(a,b,c){var d=this;this.socket.emit("getDiscoItems",a),this.socket.on("getDiscoItems",function(a,b){d.socket.removeListener("getDiscoItems"),c(a,b)})},a.prototype.getBookmarks=function(a){var b=this;this.socket.emit("getBookmarks"),this.socket.on("getBookmarks",function(c,d){b.socket.removeListener("getBookmarks"),a(c,d)})},a.prototype.setBookmarks=function(a){this.socket.emit("setBookmarks",a)},a.prototype.leaveRoom=function(a,b){this.socket.emit("leaveRoom",a,b)},a.prototype.makeid=function(){for(var a="",b="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",c=0;5>c;c++)a+=b.charAt(Math.floor(Math.random()*b.length));return a},a}();window.CommClient=CommClient;
